# GenFlow 前端技术方案

## 1. 技术选型

### 1.1 核心技术栈
- **框架:** Gradio
- **优势:**
  - 快速原型开发
  - 易于集成 AI 功能
  - Python 原生支持
  - 简单的组件系统

### 1.2 备选方案
- Streamlit (数据可视化更强)
- Panel (功能更全面)
- React + Flask (长期扩展性更好)

## 2. 界面架构

### 2.1 主要页面
1. **登录/注册页面**
2. **文章编辑器页面**
3. **文章管理页面**
4. **个人中心页面**

### 2.2 文章编辑器设计
```python
# frontend/editor.py
import gradio as gr
from app.dify_client import DifyClient

class ArticleEditor:
    def __init__(self):
        self.dify_client = DifyClient()
        
    def create_interface(self):
        with gr.Blocks() as editor:
            with gr.Row():
                # 左侧编辑区
                with gr.Column(scale=2):
                    title = gr.Textbox(label="文章标题")
                    content = gr.Textbox(label="文章内容", lines=15)
                    
                    with gr.Row():
                        suggest_btn = gr.Button("AI 建议")
                        image_btn = gr.Button("生成配图")
                        publish_btn = gr.Button("发布文章")
                
                # 右侧预览和工具区
                with gr.Column(scale=1):
                    preview = gr.HTML(label="预览")
                    image_output = gr.Image(label="生成的配图")
                    platform_select = gr.Dropdown(
                        choices=["百度", "搜狐", "网易"],
                        label="发布平台"
                    )
            
            # 事件处理
            suggest_btn.click(
                fn=self.dify_client.get_suggestion,
                inputs=[title, content],
                outputs=content
            )
            
            image_btn.click(
                fn=self.dify_client.generate_image,
                inputs=[title, content],
                outputs=image_output
            )
            
            publish_btn.click(
                fn=self.publish_article,
                inputs=[title, content, platform_select, image_output],
                outputs=gr.Text(label="发布状态")
            )
            
            # 实时预览
            content.change(
                fn=self.update_preview,
                inputs=[title, content],
                outputs=preview
            )
        
        return editor
    
    def update_preview(self, title, content):
        """将 Markdown 转换为 HTML 预览"""
        import markdown
        html = f"<h1>{title}</h1>\n{markdown.markdown(content)}"
        return html
    
    def publish_article(self, title, content, platform, image):
        """发布文章到选定平台"""
        try:
            result = self.dify_client.publish_article({
                'title': title,
                'content': content,
                'platform': platform,
                'image': image
            })
            return f"发布成功: {result['url']}"
        except Exception as e:
            return f"发布失败: {str(e)}"

# 创建编辑器实例
editor = ArticleEditor()
interface = editor.create_interface()
```

## 3. 组件设计

### 3.1 通用组件
1. **富文本编辑器**
```python
def create_rich_editor():
    with gr.Blocks() as editor:
        text_area = gr.Textbox(lines=10)
        toolbar = gr.Row([
            gr.Button("加粗"),
            gr.Button("插入链接"),
            gr.Button("插入图片")
        ])
    return editor
```

2. **文章预览组件**
```python
def create_preview():
    with gr.Blocks() as preview:
        html_view = gr.HTML()
        refresh_btn = gr.Button("刷新预览")
    return preview
```

### 3.2 AI 功能组件
1. **AI 建议面板**
```python
def create_ai_panel():
    with gr.Blocks() as panel:
        with gr.Row():
            suggestion_type = gr.Dropdown([
                "标题优化",
                "内容扩写",
                "SEO 建议"
            ])
            get_suggestion = gr.Button("获取建议")
        suggestion_output = gr.Textbox(label="AI 建议")
    return panel
```

2. **图片生成器**
```python
def create_image_generator():
    with gr.Blocks() as generator:
        prompt = gr.Textbox(label="图片描述")
        style = gr.Dropdown(["写实", "卡通", "艺术"])
        generate = gr.Button("生成图片")
        output = gr.Image()
    return generator
```

## 4. 用户交互流程

### 4.1 文章创作流程
1. 用户输入标题和初始内容
2. 可随时请求 AI 建议
3. 使用 AI 生成配图
4. 预览文章效果
5. 选择发布平台并发布

### 4.2 错误处理
```python
def handle_api_error(func):
    def wrapper(*args, **kwargs):
        try:
            return func(*args, **kwargs)
        except Exception as e:
            gr.Warning(f"操作失败: {str(e)}")
            return None
    return wrapper
```

## 5. 性能优化

### 5.1 加载优化
- 组件懒加载
- 图片压缩和渐进式加载
- 缓存常用数据

### 5.2 响应优化
- 防抖和节流处理
- 异步加载非关键数据
- 本地状态管理

## 6. 测试计划

### 6.1 单元测试
```python
def test_editor_components():
    editor = ArticleEditor()
    interface = editor.create_interface()
    
    # 测试预览功能
    html = editor.update_preview(
        "测试标题",
        "测试内容"
    )
    assert "测试标题" in html
    
    # 测试发布功能
    result = editor.publish_article(
        "测试标题",
        "测试内容",
        "百度",
        None
    )
    assert "发布成功" in result
```

### 6.2 集成测试
- API 调用测试
- 组件交互测试
- 错误处理测试

## 7. 部署说明

### 7.1 环境配置
```bash
pip install -r requirements.txt
python -m gradio frontend/app.py
```

### 7.2 生产环境配置
```python
if __name__ == "__main__":
    interface.launch(
        server_name="0.0.0.0",
        server_port=7860,
        auth=("admin", "password"),
        ssl_keyfile="key.pem",
        ssl_certfile="cert.pem"
    )
```

## 8. 后续规划

### 8.1 功能扩展
- 支持更多编辑功能
- 添加实时协作
- 集成更多 AI 模型

### 8.2 性能提升
- 引入 WebSocket
- 优化大文件处理
- 添加离线支持 